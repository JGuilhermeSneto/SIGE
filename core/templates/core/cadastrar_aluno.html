{% extends 'core/base.html' %}
{% load static %}

{% block title %}Cadastrar Discentes{% endblock %}
{% block header_title %}Cadastrar Discentes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/cadastrar_discente.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
{% endblock %}

{% block user_info %}
<span>
  Olá,
  <a href="{% url 'editar_perfil_super' %}">
    {{ request.user.get_full_name|default:request.user.username }}
  </a>
</span>
<a href="{% url 'painel_super' %}" title="Voltar">
  <i class="fas fa-arrow-left"></i>
</a>
<a href="{% url 'logout' %}" title="Sair">
  <i class="fas fa-power-off"></i>
</a>
{% endblock %}

{% block content %}
<div class="container">

    <main>
        <div class="topo-formulario">
            <h1>Cadastrar Discentes</h1>
        </div>

        <div class="conteudo-principal-rolavel">

            <!-- PASSOS -->
            <div class="passos-indicadores">
                <span class="passo ativo" id="passo-1">1. Dados Pessoais</span>
                <span class="passo inativo" id="passo-2">2. Endereço</span>
                <span class="passo inativo" id="passo-3">3. Alocação</span>
            </div>

            <!-- FORM -->
            <form method="POST" class="formulario">
                {% csrf_token %}

                <!-- ================= ETAPA 1 ================= -->
                <div class="etapa ativa" id="etapa-1">

                    <div class="caixa-texto">
                        <label>Nome completo</label>
                        <input type="text" name="nome_completo" required>
                    </div>

                    <div class="caixa-texto">
                        <label>CPF</label>
                        <input type="text" name="cpf">
                    </div>

                    <div class="caixa-texto">
                        <label>E-mail</label>
                        <input type="email" name="email" >
                    </div>

                    <div class="caixa-texto">
                        <label>Telefone</label>
                        <input type="tel" name="telefone" id="telefone">
                    </div>

                    <div class="caixa-texto">
                        <label>Data de nascimento</label>
                        <input type="date" name="data_nascimento" required>
                    </div>

                    <div class="caixa-texto">
                        <label>Naturalidade</label>
                        <select name="naturalidade" required>
                            <option disabled selected>Selecione</option>
                            <option value="brasileiro">Brasileiro(a)</option>
                            <option value="estrangeiro">Estrangeiro(a)</option>
                        </select>
                    </div>

                    <div class="caixa-texto">
                        <label>Filiação 1</label>
                        <input type="text" name="filiacao_1" required>
                    </div>

                    <div class="caixa-texto">
                        <label>Filiação 2</label>
                        <input type="text" name="filiacao_2">
                    </div>

                    <div class="caixa-texto">
                        <label>Aluno com Necessidade Especial</label>
                        <div class="radio-opcoes-simples">
                            <input type="radio" name="necessidade_especial" value="sim" id="ne_sim">
                            <label for="ne_sim">Sim</label>

                            <input type="radio" name="necessidade_especial" value="nao" id="ne_nao" checked>
                            <label for="ne_nao">Não</label>
                        </div>
                    </div>

                    <div class="caixa-texto" id="descricao-ne-container" style="display:none;">
                        <label>Descrição</label>
                        <textarea name="descricao_necessidade" required></textarea>
                    </div>

                    <div class="botoes">
                        <button type="button" class="btn" onclick="proximaEtapa(1)">Próximo</button>
                    </div>
                </div>

                <!-- ================= ETAPA 2 ================= -->
                <div class="etapa" id="etapa-2">

                    <div class="caixa-texto">
                        <label>CEP</label>
                        <input type="text" name="cep">
                    </div>

                    <div class="caixa-texto">
                        <label>Estado</label>
                        <select name="estado">
                            <option disabled selected>UF</option>
                            <option value="SP">SP</option>
                            <option value="RJ">RJ</option>
                        </select>
                    </div>

                    <div class="caixa-texto">
                        <label>Cidade</label>
                        <input type="text" name="cidade">
                    </div>

                    <div class="caixa-texto">
                        <label>Bairro</label>
                        <input type="text" name="bairro">
                    </div>

                    <div class="caixa-texto">
                        <label>Logradouro</label>
                        <input type="text" name="logradouro">
                    </div>

                    <div class="caixa-texto">
                        <label>Número</label>
                        <input type="text" name="numero">
                    </div>

                    <div class="botoes">
                        <button type="button" class="btn-voltar-tab" onclick="voltarEtapa(2)">Anterior</button>
                        <button type="button" class="btn" onclick="proximaEtapa(2)">Próximo</button>
                    </div>
                </div>

                <!-- ================= ETAPA 3 ================= -->
                <div class="etapa" id="etapa-3">

                    <div class="caixa-texto">
                        <label>Turma</label>
                        <select name="turma" required>
                            <option value="">Selecione</option>
                            {% for turma in turmas %}
                                <option value="{{ turma.id }}">{{ turma.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="caixa-texto">
                        <label>Senha</label>
                        <input type="password" name="senha" required>
                    </div>

                    <div class="caixa-texto">
                        <label>Confirmar senha</label>
                        <input type="password" name="confirmar_senha" required>
                    </div>

                    <div class="botoes">
                        <button type="button" class="btn-voltar-tab" onclick="voltarEtapa(3)">Anterior</button>
                        <button type="submit" class="btn">Salvar Cadastro</button>
                    </div>
                </div>

            </form>
        </div>
    </main>
</div>

<script>
function atualizarPassos(etapaAtual) {
    const passos = document.querySelectorAll(".passo");

    passos.forEach((passo, index) => {
        passo.classList.remove("ativo", "completo", "inativo");

        const numero = index + 1;

        if (numero < etapaAtual) {
            passo.classList.add("completo");
        } else if (numero === etapaAtual) {
            passo.classList.add("ativo");
        } else {
            passo.classList.add("inativo");
        }
    });
}

function mostrarEtapa(etapa) {
    document.querySelectorAll(".etapa").forEach(e => {
        e.classList.remove("ativa");
    });

    document.getElementById(`etapa-${etapa}`).classList.add("ativa");
    atualizarPassos(etapa);
}

function proximaEtapa(atual) {
    mostrarEtapa(atual + 1);
}

function voltarEtapa(atual) {
    mostrarEtapa(atual - 1);
}

// Necessidade especial
document.getElementById("ne_sim").onchange = () => {
    document.getElementById("descricao-ne-container").style.display = "flex";
};
document.getElementById("ne_nao").onchange = () => {
    document.getElementById("descricao-ne-container").style.display = "none";
};
</script>

{% endblock %} 