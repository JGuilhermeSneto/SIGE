{% extends 'core/base.html' %}
{% load custom_tags %}
{% load static %}

{% block title %}Lançar Notas - {{ disciplina.nome }}{% endblock %}
{% block header_title %}Lançar Notas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/cadastro_gestor.css' %}">
{% endblock %}

{% block content %}
<main>

  <div class="conteudo-principal-rolavel">

    <!-- TOPO -->
    <div class="topo-formulario">
      <h1>
        {{ disciplina.nome }} — Turma {{ disciplina.turma.nome }}
      </h1>
    </div>

    <!-- FORM -->
    <form method="post" class="formulario">
      {% csrf_token %}

      <!-- TABELA -->
      <div style="overflow-x:auto; margin-top:30px;">
        <table style="width:100%; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom:1px solid #e0e0e0;">
              <th style="text-align:left; padding:12px;">Aluno</th>
              <th>1º</th>
              <th>2º</th>
              <th>3º</th>
              <th>4º</th>
              <th>Média</th>
            </tr>
          </thead>

          <tbody>
            {% for aluno in alunos %}
            <tr style="border-bottom:1px solid #f0f0f0;">
              <td style="padding:12px; font-weight:500;">
                {{ aluno.user.get_full_name }}
              </td>

              {% with nota=notas_dict|get_item:aluno.id %}
                <td>
                  <input type="number" step="0.1"
                         name="nota1_{{ aluno.id }}"
                         value="{{ nota.nota1|default_if_none:'' }}">
                </td>
                <td>
                  <input type="number" step="0.1"
                         name="nota2_{{ aluno.id }}"
                         value="{{ nota.nota2|default_if_none:'' }}">
                </td>
                <td>
                  <input type="number" step="0.1"
                         name="nota3_{{ aluno.id }}"
                         value="{{ nota.nota3|default_if_none:'' }}">
                </td>
                <td>
                  <input type="number" step="0.1"
                         name="nota4_{{ aluno.id }}"
                         value="{{ nota.nota4|default_if_none:'' }}">
                </td>

                <td style="font-weight:600;">
                  {% if nota.media %}
                    {{ nota.media|floatformat:2 }}
                  {% else %}
                    —
                  {% endif %}
                </td>
              {% endwith %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- BOTÕES -->
      <div class="botoes" style="margin-top:40px;">

        <!-- VOLTAR PARA A DISCIPLINA -->
        <a href="{% url 'visualizar_disciplinas' disciplina.id %}"
           class="btn-voltar2">
          Voltar
        </a>

        <!-- SALVAR -->
        <button type="submit" class="btn">
          Salvar Notas
        </button>
      </div>

    </form>
  </div>

</main>
{% endblock %}
